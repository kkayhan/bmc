name: evpn_ospf-unnumbered
prefix: ""

topology:
  defaults:
    kind: nokia_srlinux
  kinds:
    nokia_srlinux:
      image: ghcr.io/nokia/srlinux:25.10.1
    linux:
      image: ghcr.io/srl-labs/network-multitool
#########################################################
  nodes:
    spine1:
      type: ixr-d3l
      startup-config: ./startup_configs/spine1.cfg
    spine2:
      type: ixr-d3l
      startup-config: ./startup_configs/spine2.cfg
    b-leaf1:
      type: ixr-d2l
      startup-config: ./startup_configs/b-leaf1.cfg
    b-leaf2:
      type: ixr-d2l
      startup-config: ./startup_configs/b-leaf2.cfg
    leaf1:
      type: ixr-d2l
      startup-config: ./startup_configs/leaf1.cfg
    leaf2:
      type: ixr-d2l
      startup-config: ./startup_configs/leaf2.cfg
    leaf3:
      type: ixr-d2l
      startup-config: ./startup_configs/leaf3.cfg
    leaf4:
      type: ixr-d2l
      startup-config: ./startup_configs/leaf4.cfg
#########################################################
    server1:
      kind: linux
      exec:
        - sudo ip link set eth0 down
        - sudo ip link set eth1 down
        - sudo ip link set eth2 down
        - sudo ip link set eth3 down
        - sudo ip link set eth4 down
        
        # Create Bonds with LACP (Mode 4 / 802.3ad)
        # miimon 100 is required for LACP link monitoring
        # lacp_rate fast requests packets every 1 second
        - sudo ip link add bond0 type bond mode 802.3ad miimon 100 lacp_rate fast
        - sudo ip link add bond1 type bond mode 802.3ad miimon 100 lacp_rate fast
        
        # Enslave Physical Interfaces
        - sudo ip link set eth1 master bond0
        - sudo ip link set eth2 master bond0
        - sudo ip link set eth3 master bond1
        - sudo ip link set eth4 master bond1
        
        # Bring Physical Interfaces and Bonds Up
        - sudo ip link set eth1 up
        - sudo ip link set eth2 up
        - sudo ip link set eth3 up
        - sudo ip link set eth4 up
        - sudo ip link set bond0 up
        - sudo ip link set bond1 up
        
        # Create VLAN 10 Interfaces (802.1Q)
        - sudo ip link add link bond0 name bond0.10 type vlan id 10
        - sudo ip link add link bond1 name bond1.10 type vlan id 10
        
        # Assign IPs to VLAN Interfaces
        - sudo ip addr add 100.99.98.1/24 dev bond0.10
        - sudo ip addr add 10.10.10.1/24 dev bond1.10
        
        # Bring VLAN Interfaces Up
        - sudo ip link set bond0.10 up
        - sudo ip link set bond1.10 up
        
        # Routing
        - sudo ip route add default via 100.99.98.254

    server2:
      kind: linux
      exec:
        - sudo ip link set eth0 down
        - sudo ip link set eth1 down
        - sudo ip link set eth2 down
        - sudo ip link set eth3 down
        - sudo ip link set eth4 down
        
        # Create Bonds with LACP (Mode 4 / 802.3ad)
        # miimon 100 is required for LACP link monitoring
        # lacp_rate fast requests packets every 1 second
        - sudo ip link add bond0 type bond mode 802.3ad miimon 100 lacp_rate fast
        - sudo ip link add bond1 type bond mode 802.3ad miimon 100 lacp_rate fast
        
        # Enslave Physical Interfaces
        - sudo ip link set eth1 master bond0
        - sudo ip link set eth2 master bond0
        - sudo ip link set eth3 master bond1
        - sudo ip link set eth4 master bond1
        
        # Bring Physical Interfaces and Bonds Up
        - sudo ip link set eth1 up
        - sudo ip link set eth2 up
        - sudo ip link set eth3 up
        - sudo ip link set eth4 up
        - sudo ip link set bond0 up
        - sudo ip link set bond1 up
        
        # Create VLAN 10 Interfaces (802.1Q)
        - sudo ip link add link bond0 name bond0.10 type vlan id 10
        - sudo ip link add link bond1 name bond1.10 type vlan id 10
        
        # Assign IPs to VLAN Interfaces
        - sudo ip addr add 100.99.98.2/24 dev bond0.10
        - sudo ip addr add 10.10.10.2/24 dev bond1.10
        
        # Bring VLAN Interfaces Up
        - sudo ip link set bond0.10 up
        - sudo ip link set bond1.10 up
        
        # Routing
        - sudo ip route add default via 100.99.98.254

  links:
  # Border Leaf - Spine
    - endpoints: ["b-leaf1:e1-49", "spine1:e1-31"]
    - endpoints: ["b-leaf1:e1-50", "spine2:e1-31"]
    - endpoints: ["b-leaf2:e1-49", "spine1:e1-32"]
    - endpoints: ["b-leaf2:e1-50", "spine2:e1-32"]
  # Spine1 - Leaf
    - endpoints: ["spine1:e1-1", "leaf1:e1-49"]
    - endpoints: ["spine1:e1-2", "leaf2:e1-49"]
    - endpoints: ["spine1:e1-3", "leaf3:e1-49"]
    - endpoints: ["spine1:e1-4", "leaf4:e1-49"]
  # Spine2 - Leaf
    - endpoints: ["spine2:e1-1", "leaf1:e1-50"]
    - endpoints: ["spine2:e1-2", "leaf2:e1-50"]
    - endpoints: ["spine2:e1-3", "leaf3:e1-50"]
    - endpoints: ["spine2:e1-4", "leaf4:e1-50"]

#### Access ###
  # server-1
      #bond0
    - endpoints: ["server1:eth1", "leaf1:e1-1"]
    - endpoints: ["server1:eth2", "leaf2:e1-1"]

      #bond1
    - endpoints: ["server1:eth3", "leaf1:e1-2"]
    - endpoints: ["server1:eth4", "leaf2:e1-2"]

  # server-2
    #bond0
    - endpoints: ["server2:eth1", "leaf3:e1-1"]
    - endpoints: ["server2:eth2", "leaf4:e1-1"]

    #bond1
    - endpoints: ["server2:eth3", "leaf3:e1-2"]
    - endpoints: ["server2:eth4", "leaf4:e1-2"]
